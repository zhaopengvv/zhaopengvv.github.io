<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Yourname"><title>zhpng</title><meta name="description" content="A simple and beautiful blog"><meta name="keywords" content="Blog,博客,Hexo"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.webp"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/insight.css"><link rel="stylesheet" href="/css/search.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><script src="/js/jquery.js"></script><meta name="generator" content="Hexo 6.3.0"></head><body><div class="page-top animated fadeInDown"><div class="nav"><li> <a class="current" href="/">Home</a></li><li> <a href="/archives">Archives</a></li><li> <a href="/tags">Tags</a></li><li> <a href="/about">About</a></li><li> <a href="/links">Links</a></li></div><div class="information"><div class="nav_right_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)" style="display:none;"> </a></li><li><a class="fa fa-search" onclick="openWindow();"></a></li></div><div class="avatar"><img src="/images/logo.webp"></div></div></div><div class="sidebar animated fadeInDown"><div class="sidebar-top"><div class="logo-title"><div class="title"><img src="/images/logo@2x.webp" style="width:220px;" alt="favicon"><h3 title=""><a href="/">zhpng</a></h3><div class="description"><p>A simple and beautiful blog</p></div></div><ul class="social-links"><li><a target="_blank" rel="noopener" href="https://github.com/Lhcfl"><i class="fa fa-github"></i></a></li><li><a href="mailto:yourname@example.com"><i class="fa fa-envelope"></i></a></li><li><a target="_blank" rel="noopener" href="https://zhihu.com/people/jin-xin-4-68"><i class="fa fa-mortar-board"></i></a></li></ul></div></div><div class="footer"><div class="p"> <span> 全站CC-BY-SA-3.0 </span><i class="fa fa-star"></i><span> Yourname</span></div><div class="by_farbox"><span>Powered by </span><a href="https://hexo.io/zh-cn/" target="_blank">Hexo </a><span> & </span><span>Anatolo </span></div><div class="beian"></div></div></div><div class="main"><div class="autopagerize_page_element"><div class="content"><div class="post animated fadeInDown"><div class="post-title"><h3><a href="/2023/09/24/WSL%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/">WSL安装指南</a></h3></div><div class="post-content"><div class="card"><p><span id="more"></span>

<h2 id="1-开启WSL支持"><a href="#1-开启WSL支持" class="headerlink" title="1. 开启WSL支持"></a>1. <strong>开启WSL支持</strong></h2><p>​		按 Win+X, 找到 Windows PowerShell (管理员)，并复制执行命令。该命令会激活 WSL 服务，然后需要重启系统。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Windows-Subsystem-Linux</span><br></pre></td></tr></table></figure>

<p>​		重启之后，Win + R，输入 appwiz.cpl，左上角找到“启动或关闭 Windows 功能”，会看到这个选项处于选中状态。其实吧，上面的命令就相当于手动去勾选这个功能。直接命令执行效率可能更高些。</p>
<h2 id="2-安装WSL发行版本"><a href="#2-安装WSL发行版本" class="headerlink" title="2. 安装WSL发行版本"></a>2. 安装WSL发行版本</h2><p>​		在 Windows 应用商店搜索 <code>ubuntu</code> ，选择自己喜欢的版本，安装即可。</p>
<p>​		这里我选择的是 <code>Ubuntu 20.04 LTS</code>，之后的所有内容也是基于 WSL Ubuntu 编写。</p>
<p>​		下载，安装之后，第一次打开会初始化一会</p>
<p>​		然后设置个用户名，密码</p>
<p>​		</p>
<p>​		<strong>到这里，其实咱们的 WSL 就安装好了。</strong></p>
<p>​		接下来我们让它更好用吧！</p>
<h2 id="3-apt换源"><a href="#3-apt换源" class="headerlink" title="3. apt换源"></a>3. apt换源</h2><p>​		<strong>Debian &#x2F; Ubuntu 的官方源在国内访问很慢，咱们更换为清华大学 TUNA 的软件源镜像</strong></p>
<p>​		执行下面命令，备份 apt 安装源：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak</span><br></pre></td></tr></table></figure>

<p>​		vim 编辑 sources.list ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/apt/sources.list </span><br></pre></td></tr></table></figure>

<p>​		将 sources.list 中的内容替换如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="4-更新软件"><a href="#4-更新软件" class="headerlink" title="4. 更新软件"></a><strong>4. 更新软件</strong></h2><ul>
<li>更新软件源中的所有软件列表，可以看到飞快的在刷屏，哗哗哗的</li>
</ul>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get update</span><br></pre></td></tr></table></figure>

<ul>
<li>更新软件</li>
</ul>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get upgrade</span><br><span class="line"># 更新内容稍多，差不多几分钟，玩会手机吧。。。</span><br></pre></td></tr></table></figure>

<h2 id="5-配置SSH服务器"><a href="#5-配置SSH服务器" class="headerlink" title="5. 配置SSH服务器"></a>5. <strong>配置SSH服务器</strong></h2><p>​		<strong>咱们用惯了 类似 xshell ，SecureCRT 这种 SSH 工具连接 Linux，所以顺便把 SSH 功能打通吧，用的顺手，毕竟 PowerShell 用的不是太方便！</strong></p>
<p>​		WSL 上的 SSH 服务器没有自动配置，需要手动重新安装，首先可以运行以下命令来检查</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo service ssh stop</span><br><span class="line">$ sudo /usr/sbin/sshd -d</span><br></pre></td></tr></table></figure>

<p>​		如果输出信息包括以上信息，即找不到 key，重新安装 openssh-server 就可以解决问题</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt purge openssh-server</span><br><span class="line">$ sudo apt install openssh-server</span><br></pre></td></tr></table></figure>

<p>​		然后需要配置 &#x2F;etc&#x2F;ssh&#x2F;sshd_config，用 sudo 权限运行 vim 修改如下三个关键字</p>
<p>​		记得删除 #</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Port 22</span><br><span class="line"># 这两行允许了 root 账户和密码登录</span><br><span class="line">PermitRootLogin yes</span><br><span class="line">PasswordAuthentication yes</span><br></pre></td></tr></table></figure>

<p>​		然后记得重启 ssh 服务</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo service ssh restart</span><br><span class="line">$ sudo service ssh status</span><br></pre></td></tr></table></figure>

<p>​		如果需要用密码登录 root 账户，还需要设置密码</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo passwd root</span><br></pre></td></tr></table></figure>

<p>​		然后就可以使用 SSH 工具进行连接啦，本地直接 localhost 即可</p>
</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2023-09-24</span><a class="tag" href="/categories/linux/" title="linux">linux </a><i class="fa fa-tag"></i><a class="tag" href="/tags/WSL/" title="WSL">WSL </a><span class="leancloud_visitors"></span><span>About 677 words, 2 min 15 sec  read</span></div></div></div></div><div class="post animated fadeInDown"><div class="post-title"><h3><a href="/2023/09/24/PostgreSQL%2014.3%20%E6%BA%90%E7%A0%81%E5%AE%89%E8%A3%85/">PostgreSQL 14.3 源码安装</a></h3></div><div class="post-content"><div class="card"><p><span id="more"></span>

<h2 id="1-环境准备"><a href="#1-环境准备" class="headerlink" title="1. 环境准备"></a>1. 环境准备</h2><h3 id="1-1-系统参数修改"><a href="#1-1-系统参数修改" class="headerlink" title="1.1 系统参数修改"></a>1.1 <strong>系统参数修改</strong></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">systemctl status firewalld.service 	#查看防火状态</span><br><span class="line">systemctl stop firewalld.service 	#暂时关闭防火墙</span><br><span class="line">systemctl disable firewalld.service #永久关闭防火墙</span><br><span class="line"> </span><br><span class="line">setenforce 0 	#临时关闭selinux防火墙, setenforce是Linux的selinux防火墙配置命令</span><br><span class="line">sed -i &#x27;s/SELINUX=enforcing/SELINUX=disabled/&#x27; /etc/selinux/config 	#禁用SELinux</span><br><span class="line"></span><br><span class="line">cat &gt; /etc/sysctl.conf &lt;&lt;&quot;EOF&quot;</span><br><span class="line">vm.swappiness=10 			#访问交换内存比直接访问物理内存要慢得多, swappiness参数的较低值很可能会提高整体系统性能。</span><br><span class="line">vm.zone_reclaim_mode=0		#关闭zone_reclaim模式，可以从其他zone或NUMA节点回收内存</span><br><span class="line">fs.aio-max-nr = 1048576		#系统中所允许的异步IO请求最大数目</span><br><span class="line">fs.file-max = 6815744		#系统中所允许的文件句柄最大数目</span><br><span class="line">net.ipv4.ip_local_port_range = 9000 65500	#网络连接可用作其源（本地）端口的最小和最大端口的限制</span><br><span class="line">net.core.rmem_default = 262144				#套接字接收缓冲区大小的缺省值</span><br><span class="line">net.core.rmem_max = 4194304					#套接字接收缓冲区大小的最大值</span><br><span class="line">net.core.wmem_default = 262144				#套接字发送缓冲区大小的缺省值</span><br><span class="line">net.core.wmem_max = 1048586					#套接字发送缓冲区大小的最大值</span><br><span class="line">kernel.shmmax = 1288490188					#单个共享内存段的最大值</span><br><span class="line">kernel.shmall = 314572						#可用共享内存的总量,单位是页,一般此值与kernel.shmmax相等</span><br><span class="line">kernel.shmmni = 4096						#单个共享内存段的最小值</span><br><span class="line">kernel.sem = 50100 64128000 50100 1280		#用于控制内核信号量</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">sysctl -p</span><br><span class="line"></span><br><span class="line">cat &gt;&gt; /etc/security/limits.conf &lt;&lt;&quot;EOF&quot; </span><br><span class="line">* soft nofile 131072</span><br><span class="line">* hard nofile 131072</span><br><span class="line">* soft nproc 131072</span><br><span class="line">* hard nproc 131072</span><br><span class="line">* soft core unlimited</span><br><span class="line">* hard core unlimited</span><br><span class="line">* soft memlock 50000000</span><br><span class="line">* hard memlock 50000000</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">echo &quot;* - nproc unlimited&quot; &gt; /etc/security/limits.d/90-nproc.conf</span><br><span class="line">echo &quot;session required pam_limits.so&quot; &gt;&gt; /etc/pam.d/login</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">关闭THP</span></span><br><span class="line">root用户下</span><br><span class="line">在vi /etc/rc.local最后添加如下代码</span><br><span class="line">if test -f /sys/kernel/mm/transparent_hugepage/enabled; then</span><br><span class="line">echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line">fi</span><br><span class="line">if test -f /sys/kernel/mm/transparent_hugepage/defrag; then</span><br><span class="line">echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">chmod +x /etc/rc.d/rc.local</span><br><span class="line">echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line">echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag</span><br><span class="line"></span><br><span class="line">cat /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line">cat /sys/kernel/mm/transparent_hugepage/defrag</span><br></pre></td></tr></table></figure>

<h2 id="2-源码安装"><a href="#2-源码安装" class="headerlink" title="2. 源码安装"></a>2. 源码安装</h2><h3 id="2-1-下载源码包"><a href="#2-1-下载源码包" class="headerlink" title="2.1 下载源码包"></a>2.1 下载源码包</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">下载源码包 wget https://ftp.postgresql.org/pub/source/v9.32/postgresql-9.2.tar.gz --no-check-certificate</span><br></pre></td></tr></table></figure>

<h3 id="2-2-安装依赖包"><a href="#2-2-安装依赖包" class="headerlink" title="2.2  安装依赖包"></a>2.2  安装依赖包</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y cmake make gcc zlib zlib-devel gcc-c++ perl readline readline-devel  \ python36 tcl openssl ncurses-devel openldap pam flex</span><br></pre></td></tr></table></figure>

<ul>
<li>readline (命令行编辑支持库)</li>
<li>zlib (数据压缩支持库)</li>
<li>flex (词法分析库)</li>
<li>bison (语法分析库)</li>
</ul>
<h3 id="2-3-创建用户"><a href="#2-3-创建用户" class="headerlink" title="2.3 创建用户"></a>2.3 创建用户</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">groupadd postgres</span><br><span class="line">useradd postgres</span><br><span class="line">echo &quot;postgres&quot; | passwd --stdin postgres</span><br><span class="line">chown postgres.postgres /home/postgres/.bash_profile</span><br></pre></td></tr></table></figure>

<h3 id="2-4-创建目录"><a href="#2-4-创建目录" class="headerlink" title="2.4 创建目录"></a>2.4 创建目录</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">## 创建目录</span><br><span class="line">mkdir -p /postgresql/&#123;pgdata,archive,scripts,backup,pg14,soft&#125;</span><br><span class="line">chown -R postgres:postgres /postgresql</span><br><span class="line">chmod -R 775 /postgresql</span><br></pre></td></tr></table></figure>

<p>​	pgdata：数据目录</p>
<p>​	archive：归档目录</p>
<p>​	backup：WAL目录</p>
<p>​	pg14：安装文件目录</p>
<p>​	soft：源文件目录</p>
<h3 id="2-5-编译安装"><a href="#2-5-编译安装" class="headerlink" title="2.5 编译安装"></a>2.5 编译安装</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">-- 编译</span><br><span class="line">su - postgres</span><br><span class="line">cd /postgresql/soft</span><br><span class="line">tar zxvf postgresql-14.3.tar.gz</span><br><span class="line">cd postgresql-14.3</span><br><span class="line">./configure --prefix=/postgresql/pg14</span><br><span class="line">#或增加调试</span><br><span class="line">#./configure --prefix=/postgresql/pg14 --enable-depend --enable-debug --enable-cassert CFLAGS=-O0</span><br><span class="line"></span><br><span class="line">make -j 64 &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">如果希望编译所有能编译的东西，包括文档（HTML和手册页）以及附加模块（contrib），这样键入：</span><br><span class="line">make world -j 16 &amp;&amp; make install-world </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /sbin/ldconfig /postgresql/pg14/lib</span><br></pre></td></tr></table></figure>



<h3 id="2-6-配置环境变量"><a href="#2-6-配置环境变量" class="headerlink" title="2.6  配置环境变量"></a>2.6  配置环境变量</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-- 配置环境变量</span><br><span class="line">cat &gt;&gt;  $HOME/.bash_profile &lt;&lt;&quot;EOF&quot;</span><br><span class="line">export PGPORT=5432</span><br><span class="line">export PGDATA=/postgresql/pgdata</span><br><span class="line">export PGHOME=/postgresql/pg14</span><br><span class="line">export LD_LIBRARY_PATH=$PGHOME/lib:$LD_LIBRARY_PATH</span><br><span class="line">export PATH=$PGHOME/bin:$PATH:.</span><br><span class="line">export PGHOST=$PGDATA</span><br><span class="line">export PGUSER=postgres</span><br><span class="line">export PGDATABASE=postgres</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source  $HOME/.bash_profile</span><br></pre></td></tr></table></figure>

<h3 id="2-7-初始化数据库"><a href="#2-7-初始化数据库" class="headerlink" title="2.7 初始化数据库"></a>2.7 初始化数据库</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 初始化</span><br><span class="line">/postgresql/pg14/bin/initdb -D /postgresql/pgdata -E UTF8 --locale=en_US.utf8 -U postgres</span><br></pre></td></tr></table></figure>



<h3 id="2-8-修改参数"><a href="#2-8-修改参数" class="headerlink" title="2.8 修改参数"></a>2.8 修改参数</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-- 修改参数</span><br><span class="line">cat &gt;&gt; /postgresql/pgdata/postgresql.conf &lt;&lt;&quot;EOF&quot;</span><br><span class="line">listen_addresses = &#x27;*&#x27;</span><br><span class="line">port=5432</span><br><span class="line">unix_socket_directories=&#x27;/postgresql/pgdata&#x27;</span><br><span class="line">logging_collector = on</span><br><span class="line">log_directory = &#x27;pg_log&#x27;</span><br><span class="line">log_filename = &#x27;postgresql-%a.log&#x27;</span><br><span class="line">log_truncate_on_rotation = on</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h3 id="2-9-启动数据库"><a href="#2-9-启动数据库" class="headerlink" title="2.9 启动数据库"></a>2.9 启动数据库</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- 启动</span><br><span class="line">pg_ctl start</span><br><span class="line">pg_ctl status</span><br><span class="line">pg_ctl stop</span><br><span class="line">pg_ctl stop -m fast</span><br></pre></td></tr></table></figure>

<h2 id="3-连接数据库"><a href="#3-连接数据库" class="headerlink" title="3. 连接数据库"></a>3. 连接数据库</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">su - postgres</span><br><span class="line">psql -p <span class="number">5432</span> -h <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更改数据库密码</span></span><br><span class="line">alter user postgres with password <span class="string">&#x27;postgres&#x27;</span>;</span><br></pre></td></tr></table></figure>



<h2 id="4-安装插件"><a href="#4-安装插件" class="headerlink" title="4. 安装插件"></a>4. 安装插件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-- 安装插件</span><br><span class="line">create extension pageinspect;</span><br><span class="line">create extension pg_stat_statements;</span><br><span class="line"></span><br><span class="line">select * from pg_extension;</span><br><span class="line">select * from pg_available_extensions order by name;</span><br></pre></td></tr></table></figure>

<p>​		安装PG数据库时，会建立一个与初始化数据库时的操作系统用户名同名的数据库用户，同时，这个用户是数据库的超级用户，在这OS用户下登录数据库使用的是操作系统认证，所以不需要用户名和密码。也可以通过修改pg_hba.conf文件要求输入密码。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat   &gt; /postgresql/pgdata/pg_hba.conf &lt;&lt; EOF</span><br><span class="line"></span><br><span class="line"># TYPE  DATABASE    USER    ADDRESS       METHOD</span><br><span class="line">host      all       all    0.0.0.0/0        md5</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>



<h2 id="4-错误处理"><a href="#4-错误处理" class="headerlink" title="4. 错误处理"></a>4. 错误处理</h2><h3 id="4-1-socket链接错误"><a href="#4-1-socket链接错误" class="headerlink" title="4.1 socket链接错误"></a>4.1 socket链接错误</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[postgres@iZuf6ddpzz3ipktm5kj01cZ pgdata]$ psql                                                           </span><br><span class="line">psql: error: connection to server on socket &quot;/postgresql/pgdata/.s.PGSQL.5433&quot; failed: FATAL:  no pg_hba.c</span><br><span class="line">onf entry for host &quot;[local]&quot;, user &quot;postgres&quot;, database &quot;postgres&quot;, no encryption</span><br></pre></td></tr></table></figure>

<p>指定postgresql的ip地址和端口号</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psql -p 5433 -h 47.103.xxx.xxx;</span><br></pre></td></tr></table></figure>



<h3 id="4-2-连接postgres服务端忘记密码"><a href="#4-2-连接postgres服务端忘记密码" class="headerlink" title="4.2 连接postgres服务端忘记密码"></a>4.2 连接postgres服务端忘记密码</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[postgres@iZuf6ddpzz3ipktm5kj01cZ ~]$ psql -p 5433 -h 47.103.136.252;</span><br><span class="line">Password for user postgres: </span><br><span class="line">psql: error: connection to server at &quot;47.103.136.252&quot;, port 5433 failed: FATAL:  password authentication failed for user &quot;postgres&quot;</span><br></pre></td></tr></table></figure>



<p>​	修改&#x2F;postgresql&#x2F;pgdata&#x2F;pg_hba.conf的METHOD字段为trust</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">TYPE  DATABASE    USER    ADDRESS       METHOD</span></span><br><span class="line">host      all       all    0.0.0.0/0      trust</span><br></pre></td></tr></table></figure>

<p>​	重新设置密码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">postgres=# \password</span><br><span class="line">Enter new password: </span><br><span class="line">Enter it again: </span><br></pre></td></tr></table></figure>

<p>重启服务器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pg_ctl reload</span><br></pre></td></tr></table></figure>

<h2 id="5-vscode源码调试"><a href="#5-vscode源码调试" class="headerlink" title="5. vscode源码调试"></a>5. vscode源码调试</h2><p>​		在launch.json中添加新的配置，一共有三个例子，一个postgres –help，一个initdb，一个postgres后端调试。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.2.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;configurations&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;postgres --help&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cppdbg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;request&quot;</span><span class="punctuation">:</span> <span class="string">&quot;launch&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;program&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/postgresql/pg14/bin/postgres&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;--help&quot;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;stopAtEntry&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cwd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;fileDirname&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;environment&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;externalConsole&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;MIMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gdb&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;miDebuggerArgs&quot;</span><span class="punctuation">:</span> <span class="string">&quot;--command=/home/postgres/cmd.gdb&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;setupCommands&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Enable pretty-printing for gdb&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;-enable-pretty-printing&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;ignoreFailures&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;initdb&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cppdbg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;request&quot;</span><span class="punctuation">:</span> <span class="string">&quot;launch&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;program&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/postgresql/pg14/bin/initdb&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;-D&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;&lt;datadir&gt;&quot;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;stopAtEntry&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cwd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;fileDirname&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;environment&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;externalConsole&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;MIMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gdb&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;miDebuggerArgs&quot;</span><span class="punctuation">:</span> <span class="string">&quot;--command=/home/postgres/cmd.gdb&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;setupCommands&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Enable pretty-printing for gdb&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;-enable-pretty-printing&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;ignoreFailures&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;postgres backend&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cppdbg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;request&quot;</span><span class="punctuation">:</span> <span class="string">&quot;attach&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;program&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/postgresql/pg14/bin/postgres&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;processId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;command:pickProcess&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;stopAtEntry&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;MIMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gdb&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;miDebuggerArgs&quot;</span><span class="punctuation">:</span> <span class="string">&quot;--command=/home/postgres/cmd.gdb&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;setupCommands&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Enable pretty-printing for gdb&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;-enable-pretty-printing&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;ignoreFailures&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>​		创建&#x2F;home&#x2F;postgres&#x2F;cmd.gdb文件，写入文件内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">set print element 0</span><br><span class="line">set print object on</span><br><span class="line">set prin vtbl on</span><br><span class="line">set print pretty on</span><br><span class="line">hand SIGUSR1 SIGUSR2 SIG36 SIGSTOP noprint nostop</span><br></pre></td></tr></table></figure>

<p>​		在exec_simple_query函数打断点，然后在侧边栏Run and Debug中选择postgres backend，点击调试按钮或者按F5后，输入postgres，选择。</p>
<h2 id="6-参考"><a href="#6-参考" class="headerlink" title="6. 参考"></a>6. 参考</h2><p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/2013907">https://cloud.tencent.com/developer/article/2013907</a></p>
</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2023-09-24</span><a class="tag" href="/categories/数据库/" title="数据库">数据库 </a><i class="fa fa-tag"></i><a class="tag" href="/tags/postgres/" title="postgres">postgres </a><span class="leancloud_visitors"></span><span>About 1665 words, 5 min 33 sec  read</span></div></div></div></div><div class="post animated fadeInDown"><div class="post-title"><h3><a href="/2023/09/24/%E9%AB%98%E7%89%88%E6%9C%ACgcc%E7%BC%96%E8%AF%91%E5%87%BA%E7%9A%84%E7%A8%8B%E5%BA%8F%E5%9C%A8%E4%BD%8E%E7%89%88%E6%9C%ACglibc%E6%9C%BA%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8C%E6%8A%A5%E9%94%99/">高版本gcc编译出的程序在低版本glibc机器上运行报错</a></h3></div><div class="post-content"><div class="card"><p><p>在高版本的gcc编译器编译程序，在低版本的glibc机器上运行，报如下错误：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/usr/lib64/libstdc++.so.6: version `GLIBCXX_3.4.14</span><br><span class="line">/usr/lib64/libstdc++.so.6: version `GLIBCXX_3.4.15&#x27;</span><br></pre></td></tr></table></figure>

<p>高版本GCC编译安装后的执行文件或动态库依赖高版本的GCC标准库。如果将编译结果移植到另一个同架构同系统的机子，则会运行失败。C++标准库一直存在的ABI不兼容问题，就是对同一个API，不同版本的标准库实现不同，导致在链接时失败。</p></p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2023-09-24</span><a class="tag" href="/categories/blog/" title="blog">blog </a><i class="fa fa-tag"></i><a class="tag" href="/tags/gcc/" title="gcc">gcc </a><span class="leancloud_visitors"></span><span>About 1028 words, 3 min 25 sec  read</span></div></div></div></div><div class="post animated fadeInDown"><div class="post-title"><h3><a href="/2023/09/24/hello-world/">Hello World</a></h3></div><div class="post-content"><div class="card"><p><p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p></p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2023-09-24</span><span class="leancloud_visitors"></span><span>About 75 words, 15 sec  read</span></div></div></div></div><div class="pagination"><ul class="clearfix"></ul></div></div></div></div><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/add-bookmark.js"></script><script>(function(window){var INSIGHT_CONFIG={TRANSLATION:{POSTS:"Posts",PAGES:"Pages",CATEGORIES:"Categories",TAGS:"Tags",UNTITLED:"(Untitled)",},CONTENT_URL:"/content.json",};window.INSIGHT_CONFIG=INSIGHT_CONFIG})(window);</script><script src="/js/insight.js" defer></script><div class="searchbox ins-search"><div class="searchbox-container ins-search-container"><div class="searchbox-input-wrapper"><input class="searchbox-input ins-search-input" type="text" placeholder="Search..."><span class="searchbox-close"><a class="fa fa-times-circle" onclick="closeWindow();"></a></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"><p>Seraching...</p></div></div></div></div></body></html>